import{T as M}from"./TopBar-1cf98240.js";import{r as g,f,l as k,g as $,t as w,d as P,e as x,h as I}from"./index-d832c1e0.js";import{_ as v,w as O,i as F,o as r,c as i,a as t,t as _,F as D,r as T,f as C,n as m,e as y,p as B,d as S,g as h,h as p,j as V}from"./index-ce3b82f8.js";const E={name:"PhotosPopup",props:{showPopup:{type:Boolean,default:!1},reg_number:String},data(){return{photos:[]}},methods:{closePopup(){this.$emit("close-popup")}},async created(){try{const a=g(f,`cars/${this.reg_number}`);(await k(a)).items.forEach(async n=>{const l=await $(n);this.photos.push({url:l})})}catch(a){console.error(a)}}},q={class:"popup-container"},L={class:"popup"},U={class:"photos"},N=["src"];function R(a,e,n,l,s,o){return O((r(),i("div",q,[t("div",L,[t("h2",null,"Photos of your car with registration number: "+_(n.reg_number),1),t("div",U,[(r(!0),i(D,null,T(s.photos,(c,u)=>(r(),i("img",{key:u,src:c.url},null,8,N))),128))]),t("button",{onClick:e[0]||(e[0]=(...c)=>o.closePopup&&o.closePopup(...c))},"Close")])],512)),[[F,n.showPopup]])}const A=v(E,[["render",R],["__scopeId","data-v-db2b4d7b"]]);const j={name:"CarComponentsInterval",props:{reg_number:String},data(){return{car_maitenance:null}},created(){C(async()=>{(await w(P(x,"maitenance"))).forEach(e=>{const n=e.data();n.reg_number===this.reg_number&&(this.car_maitenance=n)})})},computed:{brakePadsDate(){if(this.car_maitenance&&this.car_maitenance.brake_pads)return this.formatDate(this.car_maitenance.brake_pads)},brakePadsBoxColor(){if(this.car_maitenance&&this.car_maitenance.brake_pads)return this.getBoxColor(this.car_maitenance.brake_pads)},motorOilDate(){if(this.car_maitenance&&this.car_maitenance.motor_oil)return this.formatDate(this.car_maitenance.motor_oil)},motorOilBoxColor(){if(this.car_maitenance&&this.car_maitenance.motor_oil)return this.getBoxColor(this.car_maitenance.motor_oil)},coolantFluidDate(){if(this.car_maitenance&&this.car_maitenance.coolant_fluid)return this.formatDate(this.car_maitenance.coolant_fluid)},coolantFluidBoxColor(){if(this.car_maitenance&&this.car_maitenance.coolant_fluid)return this.getBoxColor(this.car_maitenance.coolant_fluid)},OverallConditionDate(){if(this.car_maitenance&&this.car_maitenance.overall_condition)return this.formatDate(this.car_maitenance.overall_condition)},OverallConditionBoxColor(){if(this.car_maitenance&&this.car_maitenance.overall_condition)return this.getBoxColor(this.car_maitenance.overall_condition)}},methods:{formatDate(a){const e=a.toDate(),n={year:"numeric",month:"short",day:"numeric"};return e.toLocaleDateString("en-US",n).toUpperCase()},getBoxColor(a){const e=a.toDate(),n=new Date,l=e.getTime()-n.getTime(),s=Math.ceil(l/(1e3*3600*24));return s<=0?"red":s<=7?"orange":"green"},openMaitenanceForm(){this.$router.push({name:"EditCarView",params:{reg_number:this.reg_number}})}}},b=a=>(B("data-v-7c7e296d"),a=a(),S(),a),z={key:0},H={class:"car-data"},W={class:"maintenance-item"},G=b(()=>t("div",{class:"maitenance-part"},[t("span",null,"Motor oil and filters:")],-1)),J={class:"maitenance-date"},K={class:"maintenance-item"},Q=b(()=>t("div",{class:"maitenance-part"},[t("span",null,"Coolant fluid:")],-1)),X={class:"maitenance-date"},Y={class:"maintenance-item"},Z=b(()=>t("div",{class:"maitenance-part"},[t("span",null,"Braking system:")],-1)),tt={class:"maitenance-date"},et={class:"maintenance-item"},at=b(()=>t("div",{class:"maitenance-part"},[t("span",null,"Overall maitenance:")],-1)),ot={class:"maitenance-date"},nt={class:"button-wrapper"};function st(a,e,n,l,s,o){return r(),i(D,null,[s.car_maitenance?(r(),i("div",z,[t("div",H,[t("div",W,[G,t("div",J,[t("span",null,_(o.motorOilDate),1),t("div",{class:m(["color-box",o.motorOilBoxColor])},null,2)])]),t("div",K,[Q,t("div",X,[t("span",null,_(o.coolantFluidDate),1),t("div",{class:m(["color-box",o.coolantFluidBoxColor])},null,2)])]),t("div",Y,[Z,t("div",tt,[t("span",null,_(o.brakePadsDate),1),t("div",{class:m(["color-box",o.brakePadsBoxColor])},null,2)])]),t("div",et,[at,t("div",ot,[t("span",null,_(o.OverallConditionDate),1),t("div",{class:m(["color-box",o.OverallConditionBoxColor])},null,2)])])])])):y("",!0),t("div",nt,[s.car_maitenance?(r(),i("button",{key:0,class:"update-button",onClick:e[0]||(e[0]=c=>o.openMaitenanceForm(this.reg_number))},"Update Maintenance Data")):(r(),i("button",{key:1,class:"add-button",onClick:e[1]||(e[1]=c=>o.openMaitenanceForm(this.reg_number))},"Add Maintenance Data"))])],64)}const rt=v(j,[["render",st],["__scopeId","data-v-7c7e296d"]]);const it={name:"CarDetails",props:{reg_number:String},components:{PhotosPopup:A,CarComponentsInterval:rt},data(){return{car:null,hasPhotos:!1,showPopup:!1,photos:[]}},created(){C(async()=>{(await w(P(x,"cars"))).forEach(e=>{const n=e.data();n.reg_number===this.reg_number&&(this.car=n)})}),C(async()=>{const a=g(f,`cars/${this.reg_number}`);(await k(a)).items.length>0&&(this.hasPhotos=!0)})},methods:{openModal(){const a=document.querySelector(".modal");a.style.display="block",this.video=document.getElementById("video"),navigator.mediaDevices.getUserMedia({video:!0}).then(e=>{this.mediaStream=e,this.video.srcObject=e}).catch(e=>{console.log(e)})},takePhoto(){const a=document.createElement("canvas");a.width=this.video.videoWidth,a.height=this.video.videoHeight,a.getContext("2d").drawImage(this.video,0,0),a.toBlob(async e=>{const n=g(f,`cars/${this.reg_number}/${Date.now()}.png`);await I(n,e),this.closeModal()},"image/png",1)},closeModal(){const a=document.querySelector(".modal");a.style.display="none"}}},ct=a=>(B("data-v-b973ddad"),a=a(),S(),a),lt={class:"car-details"},dt={key:0,class:"car-info"},_t=ct(()=>t("h1",null,"Maitenance Data",-1)),ut={class:"car-photos"},mt={class:"modal"},ht={class:"modal-dialog"},pt={class:"modal-content"},vt=V('<div class="modal-header" data-v-b973ddad><h5 class="modal-title" data-v-b973ddad>Take a photo</h5><button type="button" class="hideButton" data-v-b973ddad></button></div><div class="modal-body" data-v-b973ddad><video id="video" width="100%" height="auto" autoplay data-v-b973ddad></video></div>',2),bt={class:"modal-footer"};function gt(a,e,n,l,s,o){const c=h("CarComponentsInterval"),u=h("photos-popup");return r(),i("div",lt,[s.car?(r(),i("div",dt,[_t,t("h4",null,_(s.car.make)+" "+_(s.car.model),1)])):y("",!0),p(c,{reg_number:this.reg_number},null,8,["reg_number"]),t("div",ut,[s.hasPhotos?(r(),i("button",{key:0,onClick:e[0]||(e[0]=d=>s.showPopup=!0)},"View Photos")):y("",!0),p(u,{"show-popup":s.showPopup,reg_number:this.reg_number,onClosePopup:e[1]||(e[1]=d=>s.showPopup=!1)},null,8,["show-popup","reg_number"]),t("button",{onClick:e[2]||(e[2]=(...d)=>o.openModal&&o.openModal(...d))},"Add Photo"),t("div",mt,[t("div",ht,[t("div",pt,[vt,t("div",bt,[t("button",{type:"button",class:"btn btn-secondary",onClick:e[3]||(e[3]=(...d)=>o.closeModal&&o.closeModal(...d))},"Close"),t("button",{type:"button",class:"btn btn-primary",onClick:e[4]||(e[4]=(...d)=>o.takePhoto&&o.takePhoto(...d))},"Take Photo")])])])])])])}const ft=v(it,[["render",gt],["__scopeId","data-v-b973ddad"]]),Ct={name:"CarDetailsView",components:{TopBar:M,CarDetails:ft}};function yt(a,e,n,l,s,o){const c=h("TopBar"),u=h("CarDetails");return r(),i(D,null,[p(c),p(u,{reg_number:this.$route.params.reg_number},null,8,["reg_number"])],64)}const Pt=v(Ct,[["render",yt]]);export{Pt as default};
