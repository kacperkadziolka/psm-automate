import{T as M}from"./TopBar-b1b28c9d.js";import{r as v,f as b,l as C,g as S,t as k,d as w,e as D,h as I}from"./index-aed13327.js";import{_ as g,w as $,i as B,o as c,c as i,a as o,t as p,F as _,r as P,f,n as x,e as y,g as m,h,j as T,p as V,d as E}from"./index-f8af5991.js";const q={name:"PhotosPopup",props:{showPopup:{type:Boolean,default:!1},reg_number:String},data(){return{photos:[]}},methods:{closePopup(){this.$emit("close-popup")}},async created(){try{const t=v(b,`cars/${this.reg_number}`);(await C(t)).items.forEach(async a=>{const l=await S(a);this.photos.push({url:l})})}catch(t){console.error(t)}}},F={class:"popup-container"},L={class:"popup"},U={class:"photos"},N=["src"];function R(t,e,a,l,n,s){return $((c(),i("div",F,[o("div",L,[o("h2",null,"Photos of your car with registration number: "+p(a.reg_number),1),o("div",U,[(c(!0),i(_,null,P(n.photos,(r,d)=>(c(),i("img",{key:d,src:r.url},null,8,N))),128))]),o("button",{onClick:e[0]||(e[0]=(...r)=>s.closePopup&&s.closePopup(...r))},"Close")])],512)),[[B,a.showPopup]])}const A=g(q,[["render",R],["__scopeId","data-v-08cd868e"]]);const j={name:"CarComponentsInterval",props:{reg_number:String},data(){return{car_maitenance:null,maintenanceItems:[{label:"Motor oil and filters",key:"motor_oil"},{label:"Coolant fluid",key:"coolant_fluid"},{label:"Braking system",key:"brake_pads"},{label:"Overall condition",key:"overall_condition"}]}},created(){f(async()=>{(await k(w(D,"maitenance"))).forEach(e=>{const a=e.data();a.reg_number===this.reg_number&&(this.car_maitenance=a)})})},methods:{getMaintenanceDate(t){if(this.car_maitenance&&this.car_maitenance[t])return this.car_maitenance[t]},formatDate(t){const e=t.toDate(),a={year:"numeric",month:"short",day:"numeric"};return e.toLocaleDateString("en-US",a).toUpperCase()},getBoxColor(t){const e=t.toDate(),a=new Date,l=e.getTime()-a.getTime(),n=Math.ceil(l/(1e3*3600*24));return n<=0?"red":n<=7?"orange":"green"},openMaitenanceForm(){this.$router.push({name:"EditCarView",params:{reg_number:this.reg_number}})}}},O={key:0},z={class:"car-data"},H={class:"maintenance-part"},W={class:"maintenance-date"},G={class:"button-wrapper"};function J(t,e,a,l,n,s){return c(),i(_,null,[n.car_maitenance?(c(),i("div",O,[o("div",z,[(c(!0),i(_,null,P(n.maintenanceItems,(r,d)=>(c(),i("div",{key:d,class:"maintenance-item"},[o("div",H,[o("span",null,p(r.label)+":",1)]),o("div",W,[o("span",null,p(s.formatDate(s.getMaintenanceDate(r.key))),1),o("div",{class:x(["color-box",s.getBoxColor(s.getMaintenanceDate(r.key))])},null,2)])]))),128))])])):y("",!0),o("div",G,[n.car_maitenance?(c(),i("button",{key:0,class:"update-button",onClick:e[0]||(e[0]=r=>s.openMaitenanceForm(this.reg_number))},"Update Maintenance Data")):(c(),i("button",{key:1,class:"add-button",onClick:e[1]||(e[1]=r=>s.openMaitenanceForm(this.reg_number))},"Add Maintenance Data"))])],64)}const K=g(j,[["render",J],["__scopeId","data-v-ead17f18"]]);const Q={name:"CarDetails",props:{reg_number:String},components:{PhotosPopup:A,CarComponentsInterval:K},data(){return{car:null,hasPhotos:!1,showPopup:!1,photos:[]}},created(){f(async()=>{(await k(w(D,"cars"))).forEach(e=>{const a=e.data();a.reg_number===this.reg_number&&(this.car=a)})}),f(async()=>{const t=v(b,`cars/${this.reg_number}`);(await C(t)).items.length>0&&(this.hasPhotos=!0)})},methods:{openModal(){const t=document.querySelector(".modal");t.style.display="block",this.video=document.getElementById("video"),navigator.mediaDevices.getUserMedia({video:!0}).then(e=>{this.mediaStream=e,this.video.srcObject=e}).catch(e=>{console.log(e)})},takePhoto(){const t=document.createElement("canvas");t.width=this.video.videoWidth,t.height=this.video.videoHeight,t.getContext("2d").drawImage(this.video,0,0),t.toBlob(async e=>{const a=v(b,`cars/${this.reg_number}/${Date.now()}.png`);await I(a,e),this.closeModal()},"image/png",1)},closeModal(){const t=document.querySelector(".modal");t.style.display="none"}}},X=t=>(V("data-v-4014a04e"),t=t(),E(),t),Y={class:"car-details"},Z={key:0,class:"car-info"},ee=X(()=>o("h1",null,"Maitenance Data",-1)),te={class:"car-photos"},oe={class:"modal"},ae={class:"modal-dialog"},ne={class:"modal-content"},se=T('<div class="modal-header" data-v-4014a04e><h5 class="modal-title" data-v-4014a04e>Take a photo</h5><button type="button" class="hideButton" data-v-4014a04e></button></div><div class="modal-body" data-v-4014a04e><video id="video" width="100%" height="auto" autoplay data-v-4014a04e></video></div>',2),re={class:"modal-footer"};function ce(t,e,a,l,n,s){const r=m("CarComponentsInterval"),d=m("photos-popup");return c(),i("div",Y,[n.car?(c(),i("div",Z,[ee,o("h4",null,p(n.car.make)+" "+p(n.car.model),1)])):y("",!0),h(r,{reg_number:this.reg_number},null,8,["reg_number"]),o("div",te,[n.hasPhotos?(c(),i("button",{key:0,onClick:e[0]||(e[0]=u=>n.showPopup=!0)},"View Photos")):y("",!0),h(d,{"show-popup":n.showPopup,reg_number:this.reg_number,onClosePopup:e[1]||(e[1]=u=>n.showPopup=!1)},null,8,["show-popup","reg_number"]),o("button",{onClick:e[2]||(e[2]=(...u)=>s.openModal&&s.openModal(...u))},"Add Photo"),o("div",oe,[o("div",ae,[o("div",ne,[se,o("div",re,[o("button",{type:"button",class:"btn btn-secondary",onClick:e[3]||(e[3]=(...u)=>s.closeModal&&s.closeModal(...u))},"Close"),o("button",{type:"button",class:"btn btn-primary",onClick:e[4]||(e[4]=(...u)=>s.takePhoto&&s.takePhoto(...u))},"Take Photo")])])])])])])}const ie=g(Q,[["render",ce],["__scopeId","data-v-4014a04e"]]),le={name:"CarDetailsView",components:{TopBar:M,CarDetails:ie}};function de(t,e,a,l,n,s){const r=m("TopBar"),d=m("CarDetails");return c(),i(_,null,[h(r),h(d,{reg_number:this.$route.params.reg_number},null,8,["reg_number"])],64)}const me=g(le,[["render",de]]);export{me as default};
